### **Kafka Console Consumer CLI**

Is lecture mein hum seekhenge ki **Kafka Topics** se data kaise read (consume) karte hain using CLI.
Hum cover karenge:

1.  **Tail Consumption:** Sirf naye (live) messages padhna.
2.  **From Beginning:** Topic ke start se purane messages padhna.
3.  **Formatting:** Message ke saath Key, Timestamp aur Partition number dekhna.

-----

#### **1. Prerequisites (Setup)**

Ordering aur Partitions ka behavior samajhne ke liye, hum ek naya topic banayenge jisme **3 Partitions** honge.

**Step 1: Create Topic with 3 Partitions**

```bash
kafka-topics.sh --bootstrap-server <YOUR_SERVER> --create --topic second_topic --partitions 3
```

-----

#### **2. Basic Consumer (Default Behavior)**

By default, Kafka Consumer sirf **naye messages** padhta hai jo consumer start hone ke **baad** aate hain (Live data).

**Command:**

```bash
kafka-console-consumer.sh --bootstrap-server <YOUR_SERVER> --topic second_topic
```

  * **Observation:** Jab aap ye command run karenge, screen par kuch nahi dikhega (blank rahega). Kyunki abhi koi naya data nahi aaya hai.

**Test Scenario:**

1.  Ek terminal mein Consumer chalayein.
2.  Dusre terminal mein Producer chalayein aur message bhejein (`Hello World`).
3.  Aap dekhenge ki Consumer turant wo message dikha dega.

-----

#### **3. Producing Data (For Testing)**

Testing ke liye hum Producer use karenge. Instructor ne ek **Special Property** use ki hai: `RoundRobinPartitioner`.

  * **Why?** Taaki data forcefully alag-alag partitions (0, 1, 2) mein distribute ho aur hum ordering check kar sakein.
  * **Warning:** Production mein iska use na karein (Efficiency kam hoti hai).

**Producer Command:**

```bash
kafka-console-producer.sh --bootstrap-server <YOUR_SERVER> --topic second_topic --producer-property partitioner.class=org.apache.kafka.clients.producer.RoundRobinPartitioner
```

  * **Input:** `hello world`, `my name is stephane`, `learning kafka`... (3-4 messages bhejein).

-----

#### **4. Reading from Beginning (History)**

Agar aapko wo messages padhne hain jo consumer start hone se pehle bheje gaye the, toh `--from-beginning` flag use karein.

**Command:**

```bash
kafka-console-consumer.sh --bootstrap-server <YOUR_SERVER> --topic second_topic --from-beginning
```

**Important Observation (Ordering Issue):**
Aap notice karenge ki messages ka order **alag (shuffled)** ho sakta hai.

  * *Example:* Aapne bheja tha `1, 2, 3, 4`.
  * *Output:* Shayad `1, 3, 2, 4` dikhe.

**Reason:**
Topic mein **3 Partitions** hain. Consumer teeno partitions se parallel mein data padh raha hai.

  * **Global Ordering guarantee nahi hoti.**
  * **Partition ke andar Ordering guarantee hoti hai.**

**Text Diagram: Multi-Partition Reading**

```text
Partition 0: [ Msg A, Msg C ]
Partition 1: [ Msg B ]       
Partition 2: [ Msg D ]

Consumer reads all at once:
Output might be: Msg A, Msg B, Msg D, Msg C (Mixed Order)
```

-----

#### **5. Advanced Formatting (Showing Metadata)**

By default, Consumer sirf `Value` dikhata hai. Agar humein dekhna hai ki message kis **Partition** mein gaya, uska **Key** kya tha, aur **Time** kya tha, toh humein `formatter` use karna padega.

**Complex Command:**

```bash
kafka-console-consumer.sh --bootstrap-server <YOUR_SERVER> --topic second_topic --formatter kafka.tools.DefaultMessageFormatter --property print.timestamp=true --property print.key=true --property print.value=true --property print.partition=true --from-beginning
```

**Output Example:**

```text
CreateTime:1634... Partition:2  null  my name is Stephane
CreateTime:1634... Partition:0  null  learning kafka
CreateTime:1634... Partition:1  null  hello world
```

**Analysis:**

  * Yahan aap dekh sakte hain ki data alag-alag partitions (2, 0, 1) se aa raha hai.
  * Agar aap sirf `Partition:2` ke messages dekhenge, toh wo hamesha correct order mein honge.

-----

### **Summary Checklist**

  * [x] **Default Mode:** Sirf new messages read karta hai.
  * [x] **--from-beginning:** Purana sara data read karta hai.
  * [x] **Ordering:** Multiple partitions mein global order guarantee nahi hoti, messages mix ho sakte hain.
  * [x] **Formatters:** `--formatter` aur `--property` use karke hidden details (Partition No, Timestamp) dekh sakte hain.

-----

**Next Step:** Consumer CLI clear hai? Ab hum **Consumer Groups** CLI ki taraf badhenge jahan hum seekhenge ki multiple consumers milkar kaise kaam karte hain. Would you like those notes?